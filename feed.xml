<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.3.2">Jekyll</generator><link href="https://lilian.boulard.fr/feed.xml" rel="self" type="application/atom+xml"/><link href="https://lilian.boulard.fr/" rel="alternate" type="text/html" hreflang="en"/><updated>2023-11-04T12:34:44+00:00</updated><id>https://lilian.boulard.fr/feed.xml</id><title type="html">blank</title><subtitle>A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. </subtitle><entry><title type="html">Self-hosting Stable Diffusion on Windows</title><link href="https://lilian.boulard.fr/blog/2022/stable-diffusion/" rel="alternate" type="text/html" title="Self-hosting Stable Diffusion on Windows"/><published>2022-09-07T18:13:00+00:00</published><updated>2022-09-07T18:13:00+00:00</updated><id>https://lilian.boulard.fr/blog/2022/stable-diffusion</id><content type="html" xml:base="https://lilian.boulard.fr/blog/2022/stable-diffusion/"><![CDATA[<blockquote class="block-warning"> <p>This blog post was written at a time before AUTOMATIC1111â€™s webui. Today, it is a much better choice. However, there are some use cases for using Stable Diffusion this way, so this post stays ðŸ˜ƒ</p> </blockquote> <p>This very short guide will show you how to run <a href="https://stability.ai/blog/stable-diffusion-announcement">Stable Diffusion</a> on Windows, and create images easily with a command-line interface.</p> <blockquote class="block-tip"> <p>The hardware specification provided by Stability AI still apply: as of writing these lines, that means youâ€™ll need a graphics card with at least 8GB of VRAM.</p> </blockquote> <h2 id="spin-up-the-docker-image">Spin up the docker image</h2> <p>First, install <a href="https://docs.docker.com/desktop/install/windows-install/">Docker Desktop</a>.</p> <p>Next, check the <a href="https://replicate.com/stability-ai/stable-diffusion">Replicate page</a> and use the command indicated in <em>Run on your own computer</em> to run a docker container with Stable Diffusion.</p> <p>For reference, as of writing these lines, the command is</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run -d -p 5000:5000 --gpus=all r8.im/stability-ai/stable-diffusion@sha256:a9758cbfbd5f3c2094457d996681af52552901775aa2d6dd0b17fd15df959bef
</code></pre></div></div> <h2 id="use-with-the-python-script-to-generate-images">Use with the Python script to generate images</h2> <p>Iâ€™ve written a simple Python script to interface with the horrible Windows commands.</p> <p>To use it, install Python, and copy <a href="https://github.com/LilianBoulard/Stable-Diffusion-Windows/blob/main/stable_diffusion.py">the script</a> to your local machine.</p> <p>Next, install the script requirements:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python -m pip install requests
</code></pre></div></div> <p>Finally, run the script with the desired arguments:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python stable_diffusion.py -h
</code></pre></div></div> <p>Example of a prompt:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python stable_diffusion.py --prompt "a cat on a car"
</code></pre></div></div> <p><img src="../assets/img/0-acatonacar.png" alt="0-a+cat+on+a+car.png"/></p> <h2 id="bonus-disable-nsfw-filter">Bonus: disable NSFW filter</h2> <blockquote class="block-tip"> <p>This is specific to version 1.4. This might not work for future/previous versions.</p> </blockquote> <p>The NSFW filter will turn the image to solid black and display a warning if it is triggered.</p> <p>In order to disable this behavior, open a prompt in the container</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker exec -it &lt;container_name&gt; /bin/sh
</code></pre></div></div> <p>Next, install a text editor, such as <code class="language-plaintext highlighter-rouge">nano</code></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt update &amp;&amp; apt install nano
</code></pre></div></div> <p>use it to modify the file <code class="language-plaintext highlighter-rouge">/src/predict.py</code></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nano /src/predict.py
</code></pre></div></div> <p>Inside nano, use <code class="language-plaintext highlighter-rouge">Ctrl + W</code> to search for <code class="language-plaintext highlighter-rouge">output = self.pipe</code>.</p> <p>Right above, youâ€™ll want to add these lines:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dummy_checker</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">images</span><span class="p">,</span> <span class="p">[</span><span class="bp">False</span><span class="p">]</span> <span class="o">*</span> <span class="nf">len</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
<span class="n">self</span><span class="p">.</span><span class="n">pipe</span><span class="p">.</span><span class="n">safety_checker</span> <span class="o">=</span> <span class="n">dummy_checker</span>
</code></pre></div></div> <p>You might also want to stop the safety model from even loading, which will save some VRAM (not tackled here).</p> <p>Restart the container, and you should be good to go !</p> <h1 id="final-thoughts">Final thoughts</h1> <p>After testing thoroughly Dall-E 2, Midjourney and Stable Diffusion, here are my thoughts:</p> <ul> <li>Dall-E and Stable Diffusion offer similar style of results, though Dall-E tends to be more in-line with what is being prompted from a standard user perspective (which is to be expected given that OpenAI is state of the art).</li> <li>Stable Diffusion has the big advantage of being free if you omit the fact that you need a 8GB+ graphics card (and ignore the electricity bill, that is). Self-hosted is very cool nonetheless. However, its results are not very impressive to me, compared to the mind-blowing results of Midjourney. <ul> <li>Update: the <a href="https://youtu.be/nVhmFski3vg">Two Minute Papers video</a> really shows what can be done if you really dive into the code (which might not be optimal with the setup described in this post), and itâ€™s absolutely mind-blowing ! From a researcher / artist perspective, this is an absolutely amazing tool !</li> </ul> </li> <li><a href="https://www.midjourney.com/showcase/">Midjourney is extremely good at what it does</a>, even more since version 4 (which at the time of writing this is in test phase).</li> </ul> <p>So, if you have a good graphics card, try Stable Diffusion, itâ€™s self-hosted, it doesnâ€™t have quotas, you can do extremely advanced things with it: itâ€™s very cool!</p> <p>You might also want to try experimenting with Dall-E 2 (though youâ€™ll need to be patient, given that access is controlled by a waitlist).</p> <p>Finally, my personal favorite is Midjourney, which you can try right now with 25 free images. Even after using these, the lowest tier is currently at 10 bucks for 200 GPU minutes, which is pretty cheap.</p> <p>If you want to use Midjourney, Iâ€™d also recommend the <a href="https://promptomania.com/midjourney-prompt-builder/">Midjourney prompt builder</a>!</p> <h1 id="references">References</h1> <p><a href="https://github.com/LilianBoulard/Stable-Diffusion-Windows">GitHub - LilianBoulard/Stable-Diffusion-Windows: Interface for self-hosting Stable Diffusion on Windows</a></p> <p><a href="https://replicate.com/stability-ai/stable-diffusion">Replicate</a></p> <p><a href="https://www.reddit.com/r/StableDiffusion/comments/wxba44/disable_hugging_face_nsfw_filter_in_three_step/">Disable Hugging Face NSFW filter in three step</a></p> <p><a href="https://promptomania.com/midjourney-prompt-builder/">promptoMANIA:: Midjourney prompt builder</a></p> <p><a href="https://youtu.be/nVhmFski3vg">Stable Diffusion: DALL-E 2 For Free, For Everyone!</a></p>]]></content><author><name></name></author><category term="stable-diffusion"/><category term="self-hosting"/><category term="windows"/><category term="github"/><summary type="html"><![CDATA[This very short guide will show you how to run Stable Diffusion on Windows, and create images easily with a command-line interface.]]></summary></entry></feed>