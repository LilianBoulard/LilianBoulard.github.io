<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Self-hosting Stable Diffusion on Windows | Lilian Boulard</title> <meta name="author" content="Lilian Boulard"> <meta name="description" content="This very short guide will show you how to run Stable Diffusion on Windows, and create images easily with a command-line interface."> <meta name="keywords" content="jekyll, academic-website, portfolio-website, research-engineer, machine-learning"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://lilian.boulard.fr/blog/2022/stable-diffusion-windows/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">LilianÂ </span>Boulard</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">Projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <script>function getPageName(){return window.location.href.slice("https://lilian.boulard.fr/blog/".length,-1).replace("/","-")}function getViews(){fetch(`https://telemetry.boulard.fr/counter/blog/${getPageName()}`,{method:"GET"}).then(e=>{if(!e.ok)throw new Error(`Could not get article views ; HTTP ${e.status}`);return e.json()}).then(e=>{let t=JSON.stringify(e);document.getElementById("views").textContent=t.views,document.getElementById("views-container").style.visibility="visible"})["catch"](e=>{throw document.getElementById("views-container").style.visibility="hidden",new Error(`Could not get article views ; ${e}`)})}function ready(){fetch(`https://telemetry.boulard.fr/counter/blog/${getPageName()}`,{method:"POST"}).then(()=>{})["catch"](()=>{})}document.addEventListener("DOMContentLoaded",ready),document.addEventListener("DOMContentLoaded",getViews);</script> <div class="post"> <header class="post-header"> <h1 class="post-title">Self-hosting Stable Diffusion on Windows</h1> <p class="post-meta">September 7, 2022</p> <p class="post-tags"> <a href="/blog/2022"> <i class="fas fa-calendar fa-sm"></i> 2022 </a> Â  Â· Â  <a href="/blog/tag/stable-diffusion"> <i class="fas fa-hashtag fa-sm"></i> stable-diffusion</a> Â  <a href="/blog/tag/self-hosting"> <i class="fas fa-hashtag fa-sm"></i> self-hosting</a> Â  <a href="/blog/tag/windows"> <i class="fas fa-hashtag fa-sm"></i> windows</a> Â  <a href="/blog/tag/github"> <i class="fas fa-hashtag fa-sm"></i> github</a> Â  </p> <div id="views-container" style="visibility: hidden;"> Â  Â· Â  <i id="views" class="fas fa-eye fa-sm"></i> Â  </div> </header> <article class="post-content"> <div id="markdown-content"> <blockquote class="block-warning"> <p>This blog post was written at a time before AUTOMATIC1111â€™s webui. Today, it is a much better choice.</p> <p>However, there are some use cases for using Stable Diffusion this way, so this post stays ðŸ˜ƒ</p> </blockquote> <p>This very short guide will show you how to run <a href="https://stability.ai/blog/stable-diffusion-announcement" rel="external nofollow noopener" target="_blank">Stable Diffusion</a> on Windows, and create images easily with a command-line interface.</p> <blockquote class="block-tip"> <p>The hardware specification provided by Stability AI still apply: as of writing these lines, that means youâ€™ll need a graphics card with at least 8GB of VRAM.</p> </blockquote> <h2 id="spin-up-the-docker-image">Spin up the docker image</h2> <p>First, install <a href="https://docs.docker.com/desktop/install/windows-install/" rel="external nofollow noopener" target="_blank">Docker Desktop</a>.</p> <p>Next, check the <a href="https://replicate.com/stability-ai/stable-diffusion" rel="external nofollow noopener" target="_blank">Replicate page</a> and use the command indicated in <em>Run on your own computer</em> to run a docker container with Stable Diffusion.</p> <p>For reference, as of writing these lines, the command is</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run -d -p 5000:5000 --gpus=all r8.im/stability-ai/stable-diffusion@sha256:a9758cbfbd5f3c2094457d996681af52552901775aa2d6dd0b17fd15df959bef
</code></pre></div></div> <h2 id="use-with-the-python-script-to-generate-images">Use with the Python script to generate images</h2> <p>Iâ€™ve written a simple Python script to interface with the horrible Windows commands.</p> <p>To use it, install Python, and copy <a href="https://github.com/LilianBoulard/Stable-Diffusion-Windows/blob/main/stable_diffusion.py" rel="external nofollow noopener" target="_blank">the script</a> to your local machine.</p> <p>Next, install the script requirements:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python -m pip install requests
</code></pre></div></div> <p>Finally, run the script with the desired arguments:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python stable_diffusion.py -h
</code></pre></div></div> <p>Example of a prompt:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python stable_diffusion.py --prompt "a cat on a car"
</code></pre></div></div> <div class="row justify-content-center"> <div class="col-7 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/0-acatonacar-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/0-acatonacar-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/0-acatonacar-1400.webp"></source> <img src="/assets/img/0-acatonacar.png" class="img-fluid" width="auto" height="auto" title="a cat on a car, generated by SD" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="bonus-disable-nsfw-filter">Bonus: disable NSFW filter</h2> <blockquote class="block-tip"> <p>This is specific to version 1.4. This might not work for future/previous versions.</p> </blockquote> <p>The NSFW filter will turn the image to solid black and display a warning if it is triggered.</p> <p>In order to disable this behavior, open a prompt in the container</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker exec -it &lt;container_name&gt; /bin/sh
</code></pre></div></div> <p>Next, install a text editor, such as <code class="language-plaintext highlighter-rouge">nano</code></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt update &amp;&amp; apt install nano
</code></pre></div></div> <p>use it to modify the file <code class="language-plaintext highlighter-rouge">/src/predict.py</code></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nano /src/predict.py
</code></pre></div></div> <p>Inside nano, use <code class="language-plaintext highlighter-rouge">Ctrl + W</code> to search for <code class="language-plaintext highlighter-rouge">output = self.pipe</code>.</p> <p>Right above, youâ€™ll want to add these lines:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dummy_checker</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">images</span><span class="p">,</span> <span class="p">[</span><span class="bp">False</span><span class="p">]</span> <span class="o">*</span> <span class="nf">len</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
<span class="n">self</span><span class="p">.</span><span class="n">pipe</span><span class="p">.</span><span class="n">safety_checker</span> <span class="o">=</span> <span class="n">dummy_checker</span>
</code></pre></div></div> <p>You might also want to stop the safety model from even loading, which will save some VRAM (not tackled here).</p> <p>Restart the container, and you should be good to go !</p> <h1 id="final-thoughts">Final thoughts</h1> <p>After testing thoroughly Dall-E 2, Midjourney and Stable Diffusion, here are my thoughts:</p> <ul> <li>Dall-E and Stable Diffusion offer similar style of results, though Dall-E tends to be more in-line with what is being prompted from a standard user perspective (which is to be expected given that OpenAI is state of the art).</li> <li>Stable Diffusion has the big advantage of being free if you omit the fact that you need a 8GB+ graphics card (and ignore the electricity bill, that is). Self-hosted is very cool nonetheless. However, its results are not very impressive to me, compared to the mind-blowing results of Midjourney. <ul> <li>Update: the <a href="https://youtu.be/nVhmFski3vg" rel="external nofollow noopener" target="_blank">Two Minute Papers video</a> really shows what can be done if you really dive into the code (which might not be optimal with the setup described in this post), and itâ€™s absolutely mind-blowing ! From a researcher / artist perspective, this is an absolutely amazing tool !</li> </ul> </li> <li> <a href="https://www.midjourney.com/showcase/" rel="external nofollow noopener" target="_blank">Midjourney is extremely good at what it does</a>, even more since version 4 (which at the time of writing this is in test phase).</li> </ul> <p>So, if you have a good graphics card, try Stable Diffusion, itâ€™s self-hosted, it doesnâ€™t have quotas, you can do extremely advanced things with it: itâ€™s very cool!</p> <p>You might also want to try experimenting with Dall-E 2 (though youâ€™ll need to be patient, given that access is controlled by a waitlist).</p> <p>Finally, my personal favorite is Midjourney, which you can try right now with 25 free images. Even after using these, the lowest tier is currently at 10 bucks for 200 GPU minutes, which is pretty cheap.</p> <p>If you want to use Midjourney, Iâ€™d also recommend the <a href="https://promptomania.com/midjourney-prompt-builder/" rel="external nofollow noopener" target="_blank">Midjourney prompt builder</a>!</p> <h1 id="references">References</h1> <p><a href="https://github.com/LilianBoulard/Stable-Diffusion-Windows" rel="external nofollow noopener" target="_blank">GitHub - LilianBoulard/Stable-Diffusion-Windows: Interface for self-hosting Stable Diffusion on Windows</a></p> <p><a href="https://replicate.com/stability-ai/stable-diffusion" rel="external nofollow noopener" target="_blank">Replicate</a></p> <p><a href="https://www.reddit.com/r/StableDiffusion/comments/wxba44/disable_hugging_face_nsfw_filter_in_three_step/" rel="external nofollow noopener" target="_blank">Disable Hugging Face NSFW filter in three step</a></p> <p><a href="https://promptomania.com/midjourney-prompt-builder/" rel="external nofollow noopener" target="_blank">promptoMANIA:: Midjourney prompt builder</a></p> <p><a href="https://youtu.be/nVhmFski3vg" rel="external nofollow noopener" target="_blank">Stable Diffusion: DALL-E 2 For Free, For Everyone!</a></p> </div> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> Â© Copyright 2023 Lilian Boulard. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Source <a href="https://github.com/LilianBoulard/LilianBoulard.github.io" target="_blank" rel="external nofollow noopener">on GitHub</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>